# Horror Maze - 恐怖迷宫

基于 SFML 3.0 的第一人称 3D 恐怖游戏，采用光线投射技术实现，具有智能 AI 追踪、声音传播系统和多种恐怖元素。

---

## 📁 项目结构

```
HorrorMazeFinal/
├── HorrorMaze/              # 主项目目录
│   ├── *.cpp                # 源代码文件
│   ├── *.h                  # 头文件
│   └── HorrorMaze.vcxproj   # Visual Studio 项目文件
├── assets/                  # 游戏资源
│   ├── maps/                # 地图文件
│   │   └── level1.txt       # 第一关地图
│   ├── textures/            # 纹理贴图
│   │   ├── snow_wall.png    # 墙壁纹理
│   │   ├── exit.png         # 出口纹理
│   │   ├── ghost_sprite.png # 鬼怪精灵
│   │   └── twin_sprite.png  # 双胞胎精灵
│   └── sounds/              # 音效文件
│       ├── Background.mp3   # 背景音乐
│       ├── GhostStepSound.mp3
│       ├── Twins1.mp3
│       ├── Twins2.mp3
│       └── HeresJohnny.mp3
└── README.md               # 本文件
```

### 核心模块

| 文件 | 功能 |
|------|------|
| `Game.cpp/h` | 游戏主循环、状态管理 |
| `Player.cpp/h` | 玩家控制、钻墙机制、闪灵系统 |
| `Ghost.cpp/h` | AI 敌人、A* 寻路、声音检测 |
| `Twin.cpp/h` | 双胞胎陷阱、声音吸引 |
| `Renderer.cpp/h` | 光线投射渲染、第一人称视角 |
| `Maze.cpp/h` | 迷宫加载和碰撞检测 |

---

## 🛠️ 依赖要求

### 必需环境
- **编译器**: Visual Studio 2019 或更高版本
- **C++ 标准**: C++17 或更高
- **图形库**: SFML 3.0.0
  - 需要模块：`sfml-graphics`, `sfml-window`, `sfml-audio`, `sfml-system`

### SFML 安装

1. 下载 SFML 3.0.0：https://www.sfml-dev.org/download.php
2. 解压到项目目录或系统库目录
3. 在 Visual Studio 中配置包含目录和库目录

---

## 🚀 编译和运行

### 方法 1：使用 Visual Studio（推荐）

1. **打开项目**
   ```
   双击 HorrorMaze/HorrorMaze.sln
   ```

2. **配置 SFML**
   - 右键项目 → 属性 → C/C++ → 常规 → 附加包含目录
   - 添加 SFML 的 `include` 路径
   - 链接器 → 常规 → 附加库目录
   - 添加 SFML 的 `lib` 路径

3. **编译**
   - 选择 Release 或 Debug 配置
   - 按 `Ctrl+Shift+B` 编译

4. **运行**
   - 按 `F5` 或 `Ctrl+F5` 启动游戏

### 方法 2：命令行编译

```bash
# 确保 SFML 已正确安装并配置环境变量
cd HorrorMaze
g++ -std=c++17 *.cpp -o HorrorMaze -lsfml-graphics -lsfml-window -lsfml-audio -lsfml-system
./HorrorMaze
```

---

## 🎮 游戏控制

### 基础操作
| 按键 | 功能 |
|------|------|
| `W/A/S/D` | 移动（前/左/后/右）|
| `鼠标移动` | 视角转向 |
| `Shift` | 奔跑（消耗体力，产生大声音）|
| `Ctrl` | 蹲走（恢复体力，降低声音）|
| `F` | 打火机开关（照明/暴露位置）|
| `E` | 钻墙/出墙 |
| `Tab` | 切换第一人称/俯视图 |
| `ESC` | 退出游戏 |

---

## 📖 游戏规则（简要）

### 目标
逃离恐怖迷宫，找到出口（绿色发光格子）。

### 核心机制
1. **鬼怪追踪**
   - 鬼通过**视觉**和**声音**追踪玩家
   - 奔跑声音大，蹲走声音小
   - 打火机开启会暴露位置（光可穿透 1 堵墙）

2. **体力系统**
   - 奔跑消耗体力，蹲走/静止恢复体力
   - 体力耗尽后无法奔跑，且体力上限永久降低

3. **钻墙能力**
   - 按 `E` 可钻入墙内（关闭打火机免疫碰撞）
   - 墙内开灯会被鬼发现

4. **双胞胎陷阱**
   - 触发后冻结玩家 4 秒
   - 发出巨大声音吸引鬼（可策略利用）

5. **闪灵机制**
   - 鬼靠近时自动触发
   - 视觉反转 + 显示逃生路径

6. **死亡条件**
   - 被鬼抓到（播放 "Here's Johnny"）
   - 时间耗尽冻死（5 分钟倒计时）

---

## ✨ 核心特性

- 🎨 **光线投射 3D 渲染**：经典 DOOM 风格第一人称视角
- 🤖 **智能 AI 系统**：A* 寻路 + 声音/视觉检测
- 🔊 **真实声音传播**：Bresenham 墙壁检测 + 距离衰减
- 🎵 **3D 音频定位**：立体声追踪鬼怪位置
- 👻 **多重恐怖元素**：双胞胎陷阱、闪灵、钻墙等
- 🌙 **动态光照系统**：打火机照明 + 距离雾化

---

## 🐛 常见问题

### 编译错误

**Q: 找不到 SFML 头文件**
A: 检查项目属性中的包含目录配置，确保指向 SFML 的 `include` 文件夹。

**Q: 链接错误 LNK2019**
A: 确保链接了所有必需的 SFML 库文件（`sfml-graphics.lib`, `sfml-window.lib` 等）。

### 运行错误

**Q: 找不到 DLL 文件**
A: 将 SFML 的 DLL 文件复制到可执行文件同目录，或添加到系统 PATH。

**Q: 音频/纹理加载失败**
A: 检查 `assets/` 文件夹是否在正确位置，确保资源文件路径正确。

**Q: 游戏闪退**
A: 检查控制台输出，确认所有资源（地图、纹理、音频）成功加载。

---

## 📝 开发信息

- **开发时间**: 2024-2025
- **开发工具**: Visual Studio 2022, SFML 3.0
- **项目类型**: CS106A 数据结构课程期末项目
- **游戏类型**: 第一人称恐怖逃生

---

## 📄 许可

本项目仅用于教育目的。
